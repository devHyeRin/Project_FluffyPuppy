<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>

<th:block layout:fragment="css">
  <link rel="stylesheet" th:href="@{/css/order/order.css}">
</th:block>

<th:block layout:fragment="script">
  <script th:src="@{/js/order/order.js}"></script>
</th:block>

<div layout:fragment="content">
  <div class="order-wrap">

    <div class="order-header">
      <h2 class="order-title">
        주문 내역
        <span class="material-symbols-outlined">local_mall</span>
      </h2>

      <ul class="breadcrumb">
        <li><a href="/"><span class="material-symbols-outlined">home</span></a></li>
        <li><span class="material-symbols-outlined">arrow_forward_ios</span></li>
        <li>주문내역</li>
      </ul>
    </div>

    <table class="table order-table">
      <colgroup>
        <col style="width: 15%"/> <col style="width: 55%"/> <col style="width: 15%"/> <col style="width: 15%"/>
      </colgroup>
      <thead>
        <tr class="text-center">
          <th>주문일자</th>
          <th>주문정보</th>
          <th>총 결제금액</th>
          <th>상태/관리</th>
        </tr>
      </thead>

      <tbody>
        <tr th:each="order : ${orders.getContent()}">
          <td class="text-center align-middle">
            <span th:text="${order.orderDate}" class="order-date"></span>
          </td>

          <td class="text-center align-middle">
            <div th:each="orderItem : ${order.orderItemDtoList}" class="order-item-box">
              <img th:src="${orderItem.imgUrl}" class="repImg" th:alt="${orderItem.itemNm}">
              <div class="order-item-info">
                <span class="order-item-name" th:text="${orderItem.itemNm}"></span>
                <div class="order-item-meta">
                  <span class="item-price" th:text="${orderItem.orderPrice}"></span>
                  <span class="item-count" th:text="' / ' + ${orderItem.count} + '개'"></span>
                </div>
              </div>
            </div>
          </td>

          <td class="text-center align-middle">
            <span class="item-price total-price-text" th:text="${order.totalPrice}"></span>
          </td>

          <td class="text-center align-middle">
            <div class="status-container">
              <th:block th:if="${order.orderStatus.name() == 'ORDER'}">
                <span class="status-badge">주문 완료</span>
                <button type="button" class="btn-cancel" th:onclick="'cancelOrder(' + ${order.orderId} + ')'">주문취소</button>
              </th:block>

              <th:block th:if="${order.orderStatus.name() == 'CANCEL'}">
                <span class="status-badge status-cancelled">취소 완료</span>
                <span class="cancel-date" th:if="${order.cancelDate}"
                      th:text="${#temporals.format(order.cancelDate, 'yyyy-MM-dd HH:mm')}"></span>
              </th:block>
            </div>
          </td>
        </tr>
        <tr th:if="${orders.isEmpty()}">
          <td colspan="4" class="no-data">주문 내역이 없습니다.</td>
        </tr>
      </tbody>
    </table>

    <div class="pagination-container" th:with="start=${(orders.number/maxPage)*maxPage+1}, end=(${(orders.totalPages == 0) ? 1 : (start + (maxPage - 1) < orders.totalPages ? start + (maxPage - 1) : orders.totalPages)})">
      <ul class="pagination">
      </ul>
    </div>

  </div>
</div>
</html>